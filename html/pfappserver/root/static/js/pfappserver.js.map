{"version":3,"sources":["../app/application.js","../admin/common.js"],"names":["getStatusMsg","jqXHR","status_msg","$","parseJSON","responseText","e","_","resetAlert","p","find","clearQueue","remove","removeClass","showAlert","type","sibling","msg","permanent","time","alert","first","clone","text","before","fadeIn","delay","slideUp","this","showWarning","showPermanentWarning","showSuccess","showPermanentSuccess","showError","form","closest","each","name","error","control","input","length","addClass","showTab","showCollapse","showPermanentError","btnError","btn","fadeOut","event","queue","dequeue","isFormInputEmpty","value","empty","attr","val","trim","isInvalidNumber","min","max","isInvalid","test","parseInt","collapse","isFormValid","valid","trigger","hasClass","tab","key","labels","fixChosenClipping","$chosenSelect","bind","next","window","scroll","unbind","off","x","offset","left","y","top","height","w","width","$dropdown","parents","filter","overflow","css","i","outerHeight","display","document","scrollTop","update_attribute","element","regex","replace_str","new_attr","undefined","replace","update_attributes","query","escapeRegExp","string","dynamic_list_update_all_attributes","elements","base_id","count","regex_str","RegExp","toString","jquery_escaped_id","escapeJqueryId","href_regex","href_replace","id","updateAction","keep_value","action","changeInputFromTemplate","updateCondition","attribute","operator","operator_new","insertBefore","value_new","initWidgets","updateSoureRuleCondition","keep","op_id","myid","oldInput","template","newInput","removeAttr","split","has_parent_modal","has_no_parent_modal","chzn_select","chosen","chzn_deselect","allow_single_deselect","defaultTime","timepicker","showSeconds","showMeridian","datepicker","autoclose","bootstrapSwitch","submitFormHideModal","modal","ajax","async","url","data","serialize","always","done","hashchange","fail","animate","activateNavLink","hash","location","found","link","sort","a","b","href","indexOf","updateSection","ajax_data","doUpdateSection","section","loader","fadeTo","append","on","search_contains","Clipboard","isSupported","tooltip","title","alert_section","prepend","updateSectionFromForm","pfOnHashChange","updater","default_url","updateDynamicRows","rows","index","tagName","option","updateDynamicRowsAfterRemove","table","tbody","children","prev","bindExportCSV","doOnce","o","click","updateExtendedDurationExample","group","padZero","fromElement","fromDate","fromString","html","toElement","now","Date","getFullYear","getMonth","getDate","getHours","getMinutes","getSeconds","Math","floor","getTime","interval","unit","duration","is","period_base","e_duration","join","searchSwitchesGenerator","errorSibling","process","json","all_or_any","searches.0.name","searches.0.op","searches.0.value","results","map","items","obfuscatedTextHover","class_remove","class_add","x_placeholder","placeholder","obfuscatedTextHoverOnEvent","obfuscatedTextHoverOffEvent","setupObfuscatedTextHover","selector","FingerbankSearch","getElementById","JSON","parse","textContent","innerHTML","mouseenter","toggleClass","mouseleave","toggle","dropdown","siblings","stopPropagation","String","prototype","asCSSIdentifier","jQuery","fn","extend","setBindId","gen_id","uniqueId","eventId","func","pfBindedEvents","proxy","_enableCategory","category","li","$section","redirectCallback","getResponseHeader","reload","ajaxSetup","timeout","cache","statusCode","401","302","parent","item","preventDefault","currentTarget","start_date_id","start_time_id","end_date_id","end_time_id","time_offset","start","end","date","$this","isActive","placement","setTimeout","target","target_wrapper","template_parent","template_control_group","copy","last","data_target","dp","inputs","days","nowDate","yyyy","m","d","dd","mm","beforeDate","format","pickers","before_str","update","setEndDate","now_str","setStartDate","updateDates","row","draggable","scope","handle","appendTo","cursor","helper","txt","push","droppable","accept","obj","dragIndex","dropIndex","delta","contextObj","rowIndex","hoverClass","drop","ui","src","detach","dst","addBack","dst_index","wrapper","last_index","src_index","insertAfter","row_model","row_new","that","menu","show","hide","stop","status","modal_id","content","confirm_link","form_id","button","str","setup","sidenav","removeAttribute","init","initModals","get","problems","severity","message","model_stripped","model","toLowerCase","search","path","headers","Accept","success","typeahead_field","typeahead_btn","add_to","add_action","typeahead","source","minLength","matcher","violationsView","add_fingerbank_trigger","console","warn"],"mappings":"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","file":"pfappserver.js","sourcesContent":["/* -*- Mode: js; indent-tabs-mode: nil; js-indent-level: 4 -*- */\n$(function () {\n    /* Load localized labels */\n    var labels = document.getElementById('labels');\n    window.labels = JSON.parse(labels.textContent || labels.innerHTML);\n\n    /* Activate toggle buttons */\n    $('body').on(\n        {'mouseenter': function(event) {\n            var btn = $(this);\n            btn.text(btn.attr('toggle-hover'));\n            btn.toggleClass('btn-success btn-danger');\n         },\n         'mouseleave': function(event) {\n             var btn = $(this);\n             var value = $.trim(btn.text());\n             if (value == btn.attr('toggle-hover')) {\n                 btn.text(btn.attr('toggle-value-else'));\n                 btn.toggleClass('btn-success btn-danger');\n             }\n         },\n         'toggle': function(event) {\n             var btn = $(this);\n             var value = btn.attr('toggle-value');\n             btn.fadeOut('fast', function(event) {\n                 btn.text(btn.attr('toggle-value-else'));\n                 if (btn.hasClass('btn-danger'))\n                     btn.removeClass('btn-danger');\n             }).fadeIn('fast');\n             btn.attr('toggle-value', btn.attr('toggle-value-else'));\n             btn.attr('toggle-value-else', value);\n             value = btn.attr('toggle-hover');\n             btn.attr('toggle-hover', btn.attr('toggle-hover-else'));\n             btn.attr('toggle-hover-else', value);\n             value = btn.attr('toggle-href');\n             btn.attr('toggle-href', btn.attr('href'));\n             btn.attr('href', value);\n         }},\n        '.btn-toggle');\n\n    /* Activate button dropdowns */\n    $('.dropdown-toggle').dropdown();\n\n    /* Activate button groups */\n    $('body').on('click', '.btn-group .btn', function(event) {\n        var btn = $(this);\n        var name = btn.attr('name');\n        var input = btn.siblings('input[name=\"' + name + '\"]');\n        input.val(btn.attr('value'));\n        input.trigger('change');\n    });\n\n    /* Don't hide special \"form\" dropdown menu */\n    $('body').on('click', '.dropdown-menu-form', function(event) {\n        event.stopPropagation();\n    });\n\n    /* Live validation for required fields */\n    $('body').on('blur', 'input[data-required]', function() {\n        isFormInputEmpty($(this));\n    });\n    $('body').on('changeDate', '.input-date[data-required]', function() {\n        isFormInputEmpty($(this));\n    });\n\n    /* Live validation for number fields */\n    $('body').on('blur', 'input[type=\"number\"]', function() {\n        var input = $(this);\n        var min = input.attr('min');\n        var max = input.attr('max');\n        if ($.trim(input.val()).length > 0)\n            isInvalidNumber(input, min, max);\n    });\n});\n\nfunction getStatusMsg(jqXHR) {\n    var status_msg;\n    try {\n        var obj = $.parseJSON(jqXHR.responseText);\n        status_msg = obj.status_msg;\n    }\n    catch(e) {}\n    if (!status_msg) status_msg = _(\"Cannot Load Content\");\n    return status_msg;\n}\n\nfunction resetAlert(p) {\n    p.find('.alert').clearQueue().remove();\n    p.find('.error').removeClass('error');\n}\n\n\nfunction showAlert(type, sibling, msg, permanent, time) {\n    if (typeof time == \"undefined\") {\n        time = 5000;\n    }\n    var alert = $(type).first().clone();\n    alert.find('span').first().text(msg);\n    sibling.before(alert);\n    if (permanent)\n        alert.fadeIn('fast');\n    else\n        alert.fadeIn('fast').delay(time).slideUp('fast', function() { $(this).remove(); });\n}\n\nfunction showWarning(sibling, msg, permanent, time) {\n    showAlert('.alert-block', sibling, msg, permanent, time);\n}\n\nfunction showPermanentWarning(sibling, msg) {\n    showWarning(sibling, msg, true);\n}\n\nfunction showSuccess(sibling, msg, permanent, time) {\n    showAlert('.alert-success', sibling, msg, permanent, time);\n}\n\nfunction showPermanentSuccess(sibling, msg) {\n    showSuccess(sibling, msg, true);\n}\n\nfunction showError(sibling, msg, permanent, time) {\n    if (typeof time == \"undefined\") {\n        time = 10000;\n    }\n    if (typeof msg == 'string') {\n        showAlert('.alert-error', sibling, msg, permanent , time);\n    }\n    else {\n        var form = sibling.closest('form');\n        $.each(msg, function(name, error) {\n            var input = form.find('[name=\"' + name + '\"]');\n            var control;\n            if (input.length) {\n                control = input.closest('.control-group');\n            } else {\n                control = form.find('[id=\"' + name + '\"].control-group:not(.hidden)');\n            }\n            if (!control.length) {\n                var label = form.find('.control-group:not(.hidden) > label[for=\"' + name + '\"].control-label');\n                control = label.closest('.control-group');\n            }\n            control.addClass('error');\n            showTab(control, input);\n            showCollapse(input);\n            showAlert('.alert-error', sibling, error, permanent, time);\n        });\n    }\n}\n\nfunction showPermanentError(sibling, msg) {\n    showError(sibling, msg, true);\n}\n\nfunction btnError(btn) {\n    btn.fadeOut('fast', function(event) {\n        $(this).addClass('btn-danger');\n    }).fadeIn('fast').delay(5000).queue(function(event) {\n        $(this).removeClass('btn-danger');\n        $(this).dequeue();\n    });\n}\n\nfunction isFormInputEmpty(input) {\n    var control = input.closest('.control-group');\n    var empty = false;\n    var value;\n\n    if (input.attr('data-toggle') == 'buttons-radio')\n        value = input.find('.active').length === 0? null : 1;\n    else\n        value = input.val();\n\n    if (value === null ||\n        typeof value == 'string' && $.trim(value).length === 0 ||\n        value.length === 0) {\n        control.addClass('error');\n        empty = true;\n\n        // If input is in a tab, show the tab\n        showTab(control, input);\n    }\n    else {\n        control.removeClass('error');\n    }\n\n    return empty;\n}\n\nfunction isInvalidNumber(input, min, max) {\n    var control = input.closest('.control-group');\n    var isInvalid = false;\n\n    if (/^[0-9]+$/.test($.trim(input.val()))) {\n        var value = parseInt(input.val());\n        if (typeof min != \"undefined\" && value < min ||\n            typeof max != \"undefined\" && value > max)\n            isInvalid = true;\n    }\n    else {\n        isInvalid = true;\n    }\n    if (isInvalid) {\n        control.addClass('error');\n        showTab(control, input);\n    }\n    else {\n        control.removeClass('error');\n    }\n\n    return isInvalid;\n}\n\nfunction showCollapse(input) {\n    input.closest('.collapse').collapse('show');\n}\n\nfunction isFormValid(form) {\n    var valid = true;\n    form.find('input[data-required]:not(:disabled), input[type=\"number\"]:not(:disabled)').each(function() {\n        var input = $(this);\n        var control = input.closest('.control-group');\n        input.trigger('blur');\n        valid = !control.hasClass('error');\n        if (!valid) {\n            showCollapse(input);\n        }\n\n        return valid;\n    });\n    return valid;\n}\n\nfunction showTab(control, input) {\n    var tab = control.closest('.tab-pane');\n    if (tab) {\n        var a = tab.closest('form').find('.nav-tabs a[href=\"#' + tab.attr('id') + '\"]');\n        a.tab('show');\n        // Scroll to the input\n//        var container = tab.closest('.modal-body');\n//        if (!container)\n//            container = $(\"body,html\");\n//        container.animate({scrollTop: input.position().top}, 'fast');\n    }\n}\n\n/* Translate a string using the general \"labels\" array defined in the wrapper.tt template */\nfunction _(key) {\n    var value = key;\n    if (labels[key]) {\n        value = labels[key];\n    }\n\n    return value;\n}\n\n/* Fixes chosen 'cut-off' when in overflow hidden elements.\n   See https://github.com/harvesthq/chosen/issues/86\n*/\nfunction fixChosenClipping($chosenSelect) {\n    // Disable mouse scroll if its dropdown is open.\n    $chosenSelect\n        .bind('chosen:showing_dropdown', function() {\n            $(this).next('.chosen-container')\n                .bind(\"mousewheel\", function() {\n                    return false;\n                });\n            $(window).scroll(function() {\n                $chosenSelect.next('.chosen-container').trigger('mouseenter.chosen');\n            });\n        })\n        .bind('chosen:hiding_dropdown', function() {\n            $(this).next('.chosen-container')\n                .unbind('mousewheel');\n            $(this).find('.chosen-drop')\n                .removeClass('fixed')\n                .attr('style', '');\n            $(window).off('scroll');\n        });\n\n    // Reposition the dropdown to fixed, so it's always on top.\n    $chosenSelect.next('.chosen-container')\n        .bind('mouseenter.chosen', function() {\n            var x = $(this).offset().left,\n                y = $(this).offset().top + $(this).height(),\n                w = $(this).width(),\n                $dropdown = $(this).find('.chosen-drop');\n\n            // If the menu is partially visible, don't change\n            // its dropdown to be fixed. This is only needed if your\n            // chosen menu might be clipped by a div or something.\n\n            // Find all the parents that might be clipping off.\n            var parents = $(this).parents().filter(function() {\n                var overflow = $(this).css('overflow');\n                return overflow === 'auto' || overflow === 'hidden' || overflow === 'scroll';\n            });\n\n            // If at least one parent is clipping off the bottom of\n            // the menu, don't proceed any further.\n            for (var i = 0; i < parents.length; i++) {\n                var parentEdge = $(parents[i]).offset().top + $(parents[i]).outerHeight();\n                if (y > parentEdge) {\n                    $dropdown.css({ 'display': 'none' });\n                    return false;\n                }\n            }\n\n            $dropdown.addClass('fixed')\n                .css({ 'top': y - $(document).scrollTop(), 'left': x, 'width': w });\n        });\n}\n\nString.prototype.asCSSIdentifier = function() {\n    return this.replace(/[^_a-zA-Z0-9]/g, '_');\n};\n","/* -*- Mode: js; indent-tabs-mode: nil; js-indent-level: 4 -*- */\n/* jshint evil: true */\n\n/*\n * Update an action input field depending on the selected action type.\n * Used in\n * - config/authentication.js\n * - config/users.js\n */\n\nfunction update_attribute(element, name, regex, replace_str) {\n    var new_attr = element.attr(name);\n    if (new_attr !== undefined) {\n        new_attr = new_attr.replace(regex, replace_str);\n        element.attr(name, new_attr);\n    }\n}\n\nfunction update_attributes(element, name, query, regex, replace_str) {\n    update_attribute(element, name, regex, replace_str);\n    element.find(query).each(function(){\n        update_attribute($(this), name, regex, replace_str);\n    });\n}\n\n\nfunction escapeRegExp(string){\n    return string.replace(/([.*+?^=!:${}()|\\[\\]\\/\\\\])/g, \"\\\\$1\");\n}\n\nfunction dynamic_list_update_all_attributes(elements, base_id, count) {\n\n    /*\n     * Update id\n     */\n\n    elements.find('.sort-handle').first().text(count +1);\n    var regex_str = base_id + \"\\\\.\" + \"[0-9]+\";\n    var regex = new RegExp(regex_str);\n    var replace_str = base_id + \".\" + count.toString();\n    update_attributes(elements, \"id\", '[id*=\"' + base_id + '.\"]', regex, replace_str);\n    update_attributes(elements, \"data-base-id\", '[data-base-id*=\"' + base_id + '.\"]', regex, replace_str);\n    update_attributes(elements, \"data-template-parent\", '[data-template-parent*=\"' + base_id + '.\"]', regex, replace_str);\n    update_attributes(elements, \"name\", '[name^=\"' + base_id + '.\"]', regex, replace_str);\n    update_attributes(elements, \"for\", '[for^=\"' + base_id + '.\"]', regex, replace_str);\n\n    /*\n     * Update href and targets there are escaped\n     */\n    var jquery_escaped_id = escapeJqueryId(base_id + \".\");\n    var href_regex = new RegExp(escapeRegExp(jquery_escaped_id) + \"[0-9]+\");\n    var href_replace = jquery_escaped_id + count.toString();\n    $.each([\"data-template-control-group\", \"href\", \"data-target-wrapper\", \"data-target\", \"data-template-parent\", \"data-sortable-item\"], function(i, id) {\n        var query = '[' + id + '*=\"' + escapeJqueryId(jquery_escaped_id) + '\"]';\n        update_attributes(elements, id, query, href_regex, href_replace);\n    });\n}\n\nfunction updateAction(type, keep_value) {\n    var action = type.val();\n    var value = type.next();\n    changeInputFromTemplate(value, $('#' + action + '_action'), keep_value);\n}\n\n/* Update a rule condition input field depending on the type of the selected attribute */\nfunction updateCondition(attribute) {\n    var type = attribute.find(':selected').attr('data-type');\n    var operator = attribute.next();\n\n    if (type != operator.attr('data-type')) {\n        // Disable fields to be replaced\n        var value = operator.next();\n        operator.attr('disabled', 1);\n        value.attr('disabled', 1);\n\n        // Replace operator field\n        var operator_new = $('#' + type + '_operator').clone();\n        $.each([\"id\", \"name\", \"data-required\"], function(i, attr) {\n            operator_new.attr(attr, operator.attr(attr));\n        });\n        operator_new.insertBefore(operator);\n\n        // Replace value field\n        var value_new = $('#' + type + '_value').clone();\n        $.each([\"id\", \"name\", \"data-required\"], function(i, attr) {\n            value_new.attr(attr, value.attr(attr));\n        });\n        value_new.insertBefore(value);\n\n        if (!operator.attr('data-type')) {\n            // Preserve values of an existing condition\n            operator_new.val(operator.val());\n            value_new.val(value.val());\n        }\n\n        // Remove previous fields\n        value.remove();\n        operator.remove();\n\n        // Remember the data type\n        operator_new.attr('data-type', type);\n\n        // Initialize rendering widgets\n        initWidgets(value_new);\n    }\n}\n\n/* Update a rule condition input field depending on the type of the selected attribute */\nfunction updateSoureRuleCondition(attribute, keep) {\n    var type = attribute.find(':selected').attr('data-type');\n    var operator = attribute.next();\n\n    if (type != operator.attr('data-type')) {\n        // Disable fields to be replaced\n        var value = operator.next();\n        var op_id = \"#\" + escapeJqueryId(operator.attr(\"id\"));\n        operator.attr('disabled', 1);\n        value.attr('disabled', 1);\n\n        // Replace operator field\n        var operator_template = $('#' + type + '_operator');\n        changeInputFromTemplate(operator, operator_template, keep);\n\n        // Replace value field\n        var value_template = $('#' + type + '_value');\n        changeInputFromTemplate(value, value_template, keep);\n\n        // Remember the data type\n        $(op_id).attr('data-type', type);\n\n    }\n}\n\n\nfunction escapeJqueryId( myid ) {\n    return myid.replace( /(:|\\.|\\[|\\]|,|=|\\\\)/g, \"\\\\$1\" );\n}\n\n\nfunction changeInputFromTemplate(oldInput, template, keep_value) {\n    var newInput = template.clone();\n    // Replace value field with the one from the templates\n    newInput.removeAttr('id');\n    newInput.attr('id', oldInput.attr('id'));\n    newInput.attr('name', oldInput.attr('name'));\n    newInput.attr('data-required', 1);\n    if (keep_value && oldInput.val()) {\n        if (newInput.attr('multiple')) {\n            newInput.val(oldInput.val().split(\",\"));\n        }\n        else {\n            newInput.val(oldInput.val());\n        }\n    }\n    newInput.insertBefore(oldInput);\n    oldInput.next(\".chosen-container\").remove();\n\n    // Remove previous field\n    oldInput.remove();\n    // Initialize rendering widgets\n    initWidgets(newInput);\n}\n\n/*\n * Checks if element has a modal as a parent\n */\nfunction has_parent_modal() {\n    return $(this).parents('.modal').length > 0;\n}\n\n/*\n * Checks if element does not have a modal as a parent\n */\nfunction has_no_parent_modal() {\n    return $(this).parents('.modal').length === 0;\n}\n\n/*\n * Initialize the rendering widgets of some elements\n */\nfunction initWidgets(elements) {\n    var chzn_select = elements.filter('.chzn-select');\n    // Chosen select must have a zero width in modal\n    chzn_select.filter(has_parent_modal).chosen({width:''});\n    chzn_select.filter(has_no_parent_modal).chosen({});\n    fixChosenClipping(chzn_select);\n    var chzn_deselect = elements.filter('.chzn-deselect');\n    // Chosen deselect must have a zero width in modal\n    chzn_select.filter(has_parent_modal).chosen({allow_single_deselect: true, width:''});\n    chzn_select.filter(has_no_parent_modal).chosen({allow_single_deselect: true});\n    fixChosenClipping(chzn_deselect);\n    elements.filter('.timepicker-default').each(function() {\n        // Keep the placeholder visible if the input has no value\n        var defaultTime = $(this).val().length? 'value' : false;\n        $(this).timepicker({ defaultTime: defaultTime, showSeconds: false, showMeridian: false });\n    });\n    elements.filter('.input-date, .input-daterange input').datepicker({ autoclose: true });\n    elements.filter('.switch').bootstrapSwitch();\n}\n\nfunction submitFormHideModal(modal,form) {\n    $.ajax({\n        'async' : false,\n        'url'   : form.attr('action'),\n        'type'  : form.attr('method') || \"POST\",\n        'data'  : form.serialize()\n        })\n        .always(function()  {\n            modal.modal('hide');\n        })\n        .done(function(data) {\n            $(window).hashchange();\n        })\n        .fail(function(jqXHR) {\n            $(\"body,html\").animate({scrollTop:0}, 'fast');\n            var status_msg = getStatusMsg(jqXHR);\n            showError($('#section h2'), status_msg);\n        });\n}\n\n/**\n * Trigger a mouse click on the sidebar navigation link matching the current location hash.\n */\nfunction activateNavLink() {\n    var hash = location.hash;\n    var found = false;\n    var link = null;\n    if (hash && hash != '#') {\n        // Find the longest match\n        // Sort links by descending order by string length\n        link = $('.sidenav .nav a').sort(function(a,b) {\n            return b.href.length - a.href.length;\n        })\n        // Find the first link\n        .filter(function(i,link) {\n            if (false === found && hash.indexOf(link.hash) === 0) {\n                found = true;\n                return found;\n            }\n            return false;\n        });\n    }\n    if (link === null)\n        link = $('.sidenav .nav a').first();\n\n    link.trigger('click');\n}\n\n/* Update #section using an ajax request */\nfunction updateSection(ajax_data) {\n    activateNavLink();\n    return doUpdateSection(ajax_data);\n}\n\nfunction doUpdateSection(ajax_data) {\n    var section = $('#section');\n    if (section) {\n        $(\"body,html\").animate({scrollTop:0}, 'fast');\n        section.loader();\n        section.fadeTo('fast', 0.5, function() {\n            $.ajax(ajax_data)\n                .always(function() {\n                    section.fadeTo('fast', 1.0, function() {\n                        section.loader('hide');\n                    });\n                    resetAlert(section);\n                })\n                .done(function(data) {\n                    section.empty();\n                    section.append(data);\n                    section.find('.input-date, .input-daterange').datepicker({ autoclose: true });\n                    section.find('.input-daterange input').on('changeDate', function(event) {\n                        // Force autoclose\n                        $('.datepicker').remove();\n                    });\n                    section.find('.timepicker-default').each(function() {\n                        // Keep the placeholder visible if the input has no value\n                        var defaultTime = $(this).val().length? 'value' : false;\n                        $(this).timepicker({ defaultTime: defaultTime, showSeconds: false, showMeridian: false });\n                    });\n                    section.find('.chzn-select:visible').chosen();\n                    section.find('.chzn-deselect:visible').chosen({allow_single_deselect: true, search_contains: true});\n                    fixChosenClipping(section.find('.chzn-select:visible, .chzn-deselect:visible'));\n                    section.find('.switch').bootstrapSwitch();\n                    if (typeof Clipboard !== 'undefined' && Clipboard.isSupported())\n                        section.find('.clipboard .icon-clipboard').tooltip({ title: _('Copy') });\n                    else\n                        section.find('.clipboard .icon-clipboard').remove();\n                    section.trigger('section.loaded');\n                })\n                .fail(function(jqXHR) {\n                    var status_msg = getStatusMsg(jqXHR);\n                    var alert_section = section.find('h1, h2, h3').first().next();\n                    if (alert_section.length === 0) {\n                        section.prepend('<div class=\"card-actions\"><h2></h2><div></div></div>');\n                        alert_section = section.find('h2').first().next();\n                    }\n                    showPermanentError(alert_section, status_msg);\n                });\n        });\n    }\n    return true;\n}\n/* Update #section using an ajax request to a form */\nfunction updateSectionFromForm(form) {\n    updateSection({\n        'url'  : form.attr('action'),\n        'type' : form.attr('method') || \"POST\",\n        'data' : form.serialize()\n    });\n}\n\n\n/* Return a function to be called when the hash changes */\nfunction pfOnHashChange(updater, default_url) {\n    return function(event) {\n        var hash = location.hash;\n        var href = '/' + hash.replace(/^#\\/*/,'');\n        if (default_url !== undefined && (href === '' || href == '/')) {\n            href = default_url;\n        }\n        return updater(href,event);\n    };\n}\n\n/* Update sort handles and inputs indexes of sortable table */\nfunction updateDynamicRows(rows) {\n    rows.each(function(index, element) {\n        $(this).find('.sort-handle').first().text(index +1);\n        $(this).find(':input, [data-toggle=\"buttons-radio\"] > a').each(function() {\n            var input = $(this);\n            var name = input.attr('name');\n            var id = input.attr('id');\n            if(name) {\n                input.attr('name', name.replace(/\\.[0-9]+/, '.' + index ));\n            }\n            if(id) {\n                input.attr('id', id.replace(/\\.[0-9]+/, '.' + index ));\n            }\n            if (this.tagName == 'SELECT') {\n                $(this).find('option').each(function() {\n                    var option = $(this);\n                    var id = option.attr('id');\n                    if(id) {\n                        option.attr('id', id.replace(/\\.[0-9]+\\./, '.' + index + '.'));\n                    }\n                    var name = option.attr('name');\n                    if(name) {\n                        option.attr('name', name.replace(/\\.[0-9]+\\./, '.' + index + '.'));\n                    }\n                });\n            }\n        });\n    });\n}\n\nfunction updateDynamicRowsAfterRemove(table) {\n    var tbody = table.children(\"tbody\");\n    var rows = tbody.children(':not(.hidden)');\n    if(table.hasClass(\"table-sortable\") ) {\n        rows = rows.filter(\":has(.sort-handle)\");\n    }\n    updateDynamicRows(rows);\n    var count = rows.length;\n    if (count < 2) {\n        var id = '#' + table.attr('id') + 'Empty';\n        if ($(id).length) {\n            // The table can be empty\n            if (count === 0) {\n                if (tbody.prev('thead').length && tbody.attr('data-no-remove') != \"yes\" )\n                    table.remove();\n                $(id).removeClass('hidden');\n            }\n        }\n        else if (count == 1) {\n            // The table can't be empty\n            tbody.children(':not(.hidden)').find('[href=\"#delete\"]').addClass('hidden');\n        }\n    }\n}\n\njQuery.fn.extend({\n  setBindId : function() {\n    return this.each(function() {\n      var o = this;\n      // Ensure we don't bind the search twice by recording which IDs we've already set it up on\n      // The ID is generated and assigned to a data tag to make sure duplicate HTML ids don't break this flow even though they aren't valid\n      if(!$(o).attr('data-do-bind-id')) {\n        var gen_id = $(\"<a></a>\").uniqueId().attr('id');\n        $(o).attr('data-do-bind-id', gen_id);\n      } \n    });\n  },\n  /* \n   * Ensures that the function passes in parameter will only be executed once for an element of the DOM \n   * Useful to bind click events when objects load without double affecting the event to existing elements\n   *\n   */\n  doOnce : function(eventId, func) {\n    if(!$.pfBindedEvents) $.pfBindedEvents = {};\n    if(!$.pfBindedEvents[eventId]) $.pfBindedEvents[eventId] = {};\n\n    return this.each(function() {\n      var o = this;\n      $(o).setBindId();\n      if($.pfBindedEvents[eventId][$(o).attr('data-do-bind-id')]) {\n        return;\n      }\n      else {\n        $.pfBindedEvents[eventId][$(o).attr('data-do-bind-id')] = true;\n        $.proxy(func, this)();\n      }\n    });\n  },\n});\n\nfunction bindExportCSV() {\n  var btnClass = '.exportCSVBtn';\n  $(btnClass).doOnce(btnClass, function(){\n    var o = this;\n    $(o).click(function() {\n      window.location = $(o).attr('data-export-url')+'?'+$($(o).attr('data-export-form')).serialize()+\"&export=export\";\n    });\n  });\n}\n\nfunction updateExtendedDurationExample(group) {\n    var fromElement = $('#extendedFrom');\n    var fromDate = fromElement.data('date');\n    var fromString = fromElement.html();\n    var toElement = $('#extendedTo');\n\n    function padZero(i) { return (i < 10)? '0'+i : i; }\n\n    if (!fromDate) {\n        // Initialize the reference date\n        var now = new Date();\n        fromString =\n            now.getFullYear() + \"-\" + padZero(now.getMonth() + 1) + \"-\" + padZero(now.getDate()) + \" \" +\n            padZero(now.getHours()) + \":\" + padZero(now.getMinutes()) + \":\" + padZero(now.getSeconds());\n        fromElement.html(fromString);\n        fromDate = Math.floor(now.getTime()/1000);\n        fromElement.data('date', fromDate);\n    }\n\n    // Build duration representation\n    var interval = group.find('[name$=\".duration.interval\"]').val();\n    var unit = group.find('[name$=\".duration.unit\"]').val();\n    if (interval && unit) {\n        var duration = interval + unit;\n        var day_base = group.find('[name$=\"day_base\"]').is(':checked');\n        if (day_base) {\n            var period_base = group.find('[name$=\"period_base\"]').is(':checked');\n            var e_duration = {\n                operator: group.find('[name$=\"operator\"]').val(),\n                interval: group.find('[name$=\"extended_duration.interval\"]').val(),\n                unit: group.find('[name$=\"extended_duration.unit\"]').val()\n            };\n            duration += period_base? \"R\" : \"F\";\n            if (e_duration.operator && e_duration.interval && e_duration.unit) {\n                duration += (e_duration.operator == 'subtract')? \"-\" : \"+\";\n                duration += e_duration.interval + e_duration.unit;\n            }\n            else {\n                duration += '+0D';\n            }\n        }\n\n        group.data('duration', duration);\n\n        $.ajax(['/configuration', 'duration', fromDate, duration].join('/'))\n            .done(function(data) {\n                toElement.html(data.status_msg);\n            });\n    }\n    else {\n        toElement.html(fromString);\n    }\n}\n\nfunction searchSwitchesGenerator(errorSibling) {\n    return function(query, process) {\n        $.ajax({\n                url : '/config/switch/search',\n                type : 'POST',\n                data: {\n                    'json': 1,\n                    'all_or_any': 'any',\n                    'searches.0.name': 'id',\n                    'searches.0.op': 'like',\n                    'searches.0.value': query,\n                },\n            })\n            .done( function(data) {\n                var results = $.map(data.items, function(i) {\n                    return i.id;\n                });\n                process(results);\n            })\n            .fail(function(jqXHR) {\n                var status_msg = getStatusMsg(jqXHR);\n                showError(errorSibling, status_msg);\n            });\n    };\n}\n\n$(function () { // DOM ready\n\n    /* redirect to URL specified in the location header */\n    var redirectCallback =  function(jqXHR) {\n        var location = jqXHR.getResponseHeader('Location');\n        if (location)\n            // Reload the page and let the server render the proper template (most likely the login page)\n            window.location.reload(true);\n    };\n\n    /* Default values for Ajax requests */\n    $.ajaxSetup({\n        timeout: 120000,\n        cache: false,\n        statusCode: {\n            401: redirectCallback,\n            302: redirectCallback\n        }\n    });\n\n    /* Register links in the sidebar list */\n    function _enableCategory(category) {\n        // Activate corresponding category\n        $('.sidenav-category .active').filter(function(i, li) {\n            if ($(li).attr('data-category') != category)\n                $(li).removeClass('active');\n        });\n        $('.sidenav-category [data-category=\"' + category + '\"]').addClass('active');\n        // Show corresponding list of sections\n        $('.sidenav-fluid .sidenav-section').each(function() {\n            var $section = $(this);\n            if ($section.attr('data-category') == category)\n                $section.removeClass('hide');\n            else\n                $section.addClass('hide');\n        });\n        $('.sidenav-fluid .sidenav-section .active').removeClass('active');\n    }\n    $('.sidenav-category a').click(function(event) {\n        var li = $(this).parent();\n        var category = li.attr('data-category');\n        _enableCategory(category);\n        return true;\n    });\n    $('.sidenav-section a:not([data-toggle]):not([target])').click(function(event) {\n        var item = $(this).parent();\n        var category = item.closest('.sidenav-section').attr('data-category');\n        _enableCategory(category);\n\n        if(item.hasClass('subsection')) {\n          item.closest('.section').addClass('active');\n        }\n        \n        item.addClass('active');\n\n        // Define the first element as active if there is none selected\n        if(item.hasClass('section') && item.find('ul').find('li.active').length === 0) {  \n          $(item.find('ul').find('li')[0]).addClass('active');\n        }\n\n        return true;\n    });\n\n    $('body').on('click', 'a[data-toggle=\"date-picker\"]', function(event) {\n        event.preventDefault();\n        var a = $(event.currentTarget);\n        $.ajax({\n            url : a.attr('href'),\n            type : 'POST'\n        }).done(function(data){\n            var start_date_id = a.attr(\"data-start-date\");\n            var start_time_id = a.attr(\"data-start-time\");\n            var end_date_id = a.attr(\"data-end-date\");\n            var end_time_id = a.attr(\"data-end-time\");\n            var time_offset = data.time_offset;\n            var start = time_offset.start;\n            var end = time_offset.end;\n            if (start_date_id) {\n                var start_date_input = $(start_date_id);\n                start_date_input.datepicker(\"setDate\", start.date);\n            }\n            if (start_time_id) {\n                var start_time_input = $(start_time_id);\n                start_time_input.timepicker(\"setTime\", start.time);\n            }\n            if (end_date_id) {\n                var end_date_input = $(end_date_id);\n                end_date_input.datepicker(\"setDate\", end.date);\n            }\n            if (end_time_id) {\n                var end_time_input = $(end_time_id);\n                end_time_input.timepicker(\"setTime\", end.time);\n            }\n        });\n        return false;\n    });\n\n    /* Register events for animation of sidebar tooltips */\n    $('.sidenav-category').on('mouseenter', '[data-category]', function(event) {\n        var $this = $(this);\n        var category = $this.data('category');\n        var isActive = $this.hasClass('active');\n        $('.sidenav-category-extend').addClass('show').find('li').each(function() {\n            var $this = $(this);\n            if (!isActive && $this.data('category') == category)\n                $this.addClass('show');\n            else\n                $this.removeClass('show');\n        });\n    });\n    $('.sidenav-category').on('mouseleave mouseup', '[data-category]', function(event) {\n        $('.sidenav-category-extend').removeClass('show')\n            .find('[data-category]').removeClass('show');\n    });\n\n    /* Enable tooltip in top navbar */\n    $('#navbar [data-toggle=\"tooltip\"]').tooltip({placement: 'bottom'});\n\n    /* Configure tooltips of \"copy to clipboard\" buttons */\n    if (typeof Clipboard !== \"undefined\" && Clipboard.isSupported()) {\n        var clipboard = new Clipboard('.icon-clipboard.btn-icon');\n        clipboard.on('success', function(e) {\n            var btn = $(e.trigger);\n            btn.tooltip('destroy').tooltip({ title: _('Copied') }).tooltip('show');\n            setTimeout(function() {\n                btn.tooltip('destroy').tooltip({ title: _('Copy') });\n            }, 3000);\n        });\n    }\n\n    $('body').on('click', '[data-toggle=\"dynamic-list\"]', function(event) {\n        event.preventDefault();\n        var link = $(this);\n        var target = $(link.attr(\"data-target\"));\n        var target_wrapper = $(link.attr(\"data-target-wrapper\"));\n        var template_parent = $(link.attr(\"data-template-parent\"));\n        var template_control_group = $(link.attr(\"data-template-control-group\"));\n        var base_id = link.attr(\"data-base-id\");\n        var copy = template_parent.clone();\n        copy.removeAttr('id');\n        copy.find(':input').each(function(i,e) {\n            var input = $(e);\n            var template_parent = input.closest('[id^=\"dynamic-list-template\"]');\n            if (template_parent.length === 0) {\n                input.removeAttr('disabled');\n                input.removeClass('disabled');\n            }\n        });\n        var index = target.children().length;\n        dynamic_list_update_all_attributes(copy, base_id, index);\n        target.append(copy.children());\n        target_wrapper.removeClass('hidden');\n        template_control_group.addClass('hidden');\n        target.children().last().trigger('dynamic-list.add');\n        return false;\n    });\n\n\n    $('body').on('click', '[data-toggle=\"dynamic-list-delete\"]', function(event) {\n        event.preventDefault();\n        var link = $(this);\n        var target_wrapper = $(link.attr(\"data-target-wrapper\"));\n        var data_target = $(link.attr(\"data-target\"));\n        var base_id = link.attr(\"data-base-id\");\n        var siblings = data_target.siblings();\n        var template_control_group = $(link.attr(\"data-template-control-group\"));\n        data_target.remove();\n        if (siblings.length === 0) {\n            target_wrapper.addClass('hidden');\n            template_control_group.removeClass('hidden');\n        } else {\n            siblings.each(function(i,e) {\n                dynamic_list_update_all_attributes($(e), base_id, i);\n            });\n        }\n        return false;\n    });\n\n    /* Range datepickers\n     * See https://github.com/eternicode/bootstrap-datepicker/tree/range */\n\n    $('body').on('changeDate', '.input-daterange input[name=\"start\"]', function(event) {\n        var dp = $(this).parent().data('datepicker');\n        // Limit the start date of the second datepicker to this new date\n        $(dp.inputs[1]).datepicker('setStartDate', event.date);\n    });\n    $('body').on('changeDate', '.input-daterange input[name=\"end\"]', function(event) {\n        var dp = $(this).parent().data('datepicker');\n        // Limit the end date of the first datepicker to this new date\n        $(dp.inputs[0]).datepicker('setEndDate', event.date);\n    });\n    $('body').on('click', '.input-daterange a[href*=\"day\"]', function(event) {\n        event.preventDefault();\n\n        // The number of days is extracted from the href attribute\n        var days = $(this).attr('href').replace(/#last([0-9]+)days?/, \"$1\");\n        var dp = $(this).closest('.input-daterange').data('datepicker');\n        var nowDate = new Date();\n        var now = {\n            yyyy: nowDate.getFullYear(),\n            m: (nowDate.getMonth() + 1),\n            d: nowDate.getDate()\n        };\n        now.dd = (now.d < 10 ? '0' : '') + now.d;\n        now.mm = (now.m < 10 ? '0' : '') + now.m;\n        var beforeDate = new Date(nowDate.getTime() - days*24*60*60*1000);\n        var before = {\n            yyyy: beforeDate.getFullYear(),\n            m: (beforeDate.getMonth() + 1),\n            d: beforeDate.getDate()\n        };\n        before.dd = (before.d < 10 ? '0' : '') + before.d;\n        before.mm = (before.m < 10 ? '0' : '') + before.m;\n\n        // Start date\n        var format = dp.pickers[0].element.attr('data-date-format');\n        var before_str = format.replace('yyyy', before.yyyy).replace('mm', before.mm).replace('dd', before.dd);\n        dp.pickers[0].element.val(before_str);\n        dp.pickers[0].update();\n        dp.pickers[0].setEndDate(beforeDate);\n        dp.pickers[0].element.trigger({ type: 'changeDate', date: dp.pickers[0].date });\n\n        // End date\n        format = dp.pickers[1].element.attr('data-date-format');\n        var now_str = format.replace('yyyy', now.yyyy).replace('mm', now.mm).replace('dd', now.dd);\n        dp.pickers[1].element.val(now_str);\n        dp.pickers[1].update();\n        dp.pickers[1].setStartDate(nowDate);\n        dp.pickers[1].element.trigger({ type: 'changeDate', date: dp.pickers[1].date });\n\n        dp.updateDates();\n\n        return false;\n    });\n\n    /* Save the list order */\n    $('#section').on('admin.ordered', '.admin_ordered', function(event) {\n        var form = $(this).closest('form');\n        $.ajax({\n            type: 'POST',\n            url: form.attr('action'),\n            data: form.serialize()\n        }).done(function(data) {\n            resetAlert($('#section'));\n            showSuccess(form, data.status_msg);\n        }).fail(function(jqXHR) {\n            var status_msg = getStatusMsg(jqXHR);\n            showPermanentError(form, status_msg);\n        });\n    });\n\n    /* Activate sortable tables and lists (rows/items can be re-ordered) */\n    $('body').on('mousemove',\n                 '.table-sortable tbody tr:not(.ui-draggable), .list-sortable li:not(.ui-draggable)',\n                 function() {\n        var row = $(this);\n        var id = row.closest('table, ul').attr('id');\n        row.draggable({\n            scope: id,\n            handle: '.sort-handle',\n            appendTo: 'body',\n            cursor: 'move',\n            helper: function(event) {\n                var txt = [];\n                if (event.target.tagName == 'TD') {\n                    var row = $(event.target).closest('tr').first();\n                    row.find('td').each(function () {\n                        // Extract text from links, selects and static fields\n                        $(this).find('a[class!=\"btn-icon\"], :selected, .uneditable').map(function() {\n                            if (!$(this).hasClass('btn'))\n                                txt.push($(this).text());\n                        });\n                        // Extract text from input fields, except hidden and checkbox\n                        $(this).find('input[type!=\"hidden\"]:not(:checkbox)').map(function() {\n                            txt.push($(this).val());\n                        });\n                    });\n                }\n                else {\n                    var a = $(event.target).closest('li').find('a').first().clone();\n                    // Remove the sort-handle\n                    a.find('span').remove();\n                    txt.push(a.text());\n                }\n                return $('<div class=\"drag-row\">' + txt.join(' ') + '</div>');\n            }\n        });\n        row.siblings().droppable({\n            scope: id,\n            accept: function(obj) {\n                var delta = 0;\n                var dragIndex;\n                var dropIndex;\n                var contextObj = obj.first()[0];\n                if (contextObj.tagName == 'TR') {\n                    dragIndex = contextObj.rowIndex;\n                    dropIndex = this.rowIndex;\n                    delta = dropIndex - dragIndex;\n                }\n                else {\n                    var items = $(this).closest('ul').children();\n                    dragIndex = items.index(obj);\n                    dropIndex = items.index(this);\n                    delta = dropIndex - dragIndex;\n                }\n                return (delta < 0 || delta > 1);\n            },\n            hoverClass: 'drop-row',\n            drop: function(event, ui) {\n                var src = ui.draggable.detach();\n                var dst = $(this);\n                src.insertBefore(dst);\n\n                // Update indexes\n                var rows = dst.siblings(':not(.hidden)').addBack();\n                updateDynamicRows(rows);\n                dst.closest('table, ul').trigger('admin.ordered');\n            }\n        });\n    });\n\n    /* Activate sortable divs (divs can be re-ordered) */\n    $('body').on('mousemove',\n                 '.dynamic-list-sortable .sort-handle:not(.ui-draggable)',\n                 function() {\n        var row = $(this);\n        var scope = row.attr('data-sortable-scope');\n        var item = $(row.attr('data-sortable-item'));\n        item.draggable({\n            scope: scope,\n            handle: '.sort-handle',\n            appendTo: 'body',\n            cursor: 'move',\n            helper: function(event) {\n                var target = $(event.target);\n                return '<div class=\"drag-row\">' + target.attr('data-sortable-text') + '</div>';\n            }\n        });\n        item.siblings().droppable({\n            scope: scope,\n            accept: function(obj) {\n                var handleIndex = obj.find('.sort-handle:first').text();\n                return handleIndex != $(this).find('.sort-handle:first').text();\n            },\n            hoverClass: 'drop-dynamic-row',\n            drop: function(event, ui) {\n                var dst = $(this);\n                var dst_index = parseInt(dst.find('.sort-handle:first').text(), 10);\n                var draggable = ui.draggable.find('.sort-handle:first');\n                var wrapper = $(draggable.attr('data-sortable-parent'));\n                var item = $(draggable.attr('data-sortable-item'));\n                var last_index = wrapper.children().length;\n                var base_id = draggable.attr(\"data-base-id\");\n                var src = item.detach();\n                var src_index = parseInt(src.find('.sort-handle:first').text(), 10);\n                if (dst_index == last_index) {\n                    wrapper.append(src);\n                }\n                else if(src_index < dst_index) {\n                    src.insertAfter(dst);\n                }\n                else {\n                    src.insertBefore(dst);\n                }\n                wrapper.children().each(function(i,e) {\n                    var element = $(e);\n                    dynamic_list_update_all_attributes(element, base_id, i);\n                });\n                wrapper.trigger('dynamic-list.ordered');\n            }\n        });\n    });\n\n    /* Activate dynamic tables (rows can be added and removed) */\n    $('body').on('click', '.table-dynamic tbody [href=\"#add\"]', function(event) {\n        $(this).trigger(\"addrow\");\n        return false;\n    });\n\n    $('body').on('addrow', '.table-dynamic', function(event) {\n        var table = $(this);\n        var row = table.find(event.target).closest('tr');\n\n        var tbody = table.children('tbody');\n        var row_model = tbody.children('.hidden').first();\n        if (row_model) {\n            var row_new = row_model.clone();\n            row_new.removeClass('hidden');\n            row_new.find(':input').removeAttr('disabled');\n            row_new.find('.btn').removeClass('disabled');\n            if (row.length > 0) {\n                row_new.insertAfter(row);\n            } else {\n                row_new.insertBefore(row_model);\n            }\n            var rows = tbody.children(':not(.hidden)');\n            if (table.hasClass(\"table-sortable\") ) {\n                rows = rows.filter(\":has(.sort-handle)\");\n            }\n            updateDynamicRows(rows);\n            var count = rows.length;\n            if (count >= 2) {\n                table = tbody.closest('table');\n                var id = '#' + table.attr('id') + 'Empty';\n                if ($(id).length) {\n                    $(id).addClass('hidden');\n                }\n                tbody.children(':not(.hidden)').find('[href=\"#delete\"]').removeClass('hidden');\n            }\n            row_new.trigger('admin.added');\n            /* Trigger SELECT change event to inherit additional triggers */ \n            row_new.find('select[name$=\".type\"]').trigger('change');\n        }\n        return false;\n    });\n\n    $('body').on('click', '.table-dynamic [href=\"#delete\"]', function(event) {\n        $(this).trigger(\"deleterow\");\n        return false;\n    });\n\n    $('body').on('deleterow', '.table-dynamic', function(event) {\n        var table = $(this);\n        var row = table.find(event.target).closest('tr');\n        var tbody = table.children('tbody');\n        row.fadeOut('fast', function() {\n            $(this).remove();\n            // Update sort handle if the table is sortable\n            //var empty = true;\n            updateDynamicRowsAfterRemove(table);\n            tbody.trigger('admin.deleted');\n        });\n        return false;\n    });\n\n    /* Activate links that trigger an ajax request and return a JSON status message */\n    $('#section').on('click','a.updates_section_status_msg', function() {\n        var that = $(this);\n        var href = that.attr('href');\n        var sibling = that.data('sibling');\n        var section = $('#section');\n        var loader = section.prev('.loader');\n        if (sibling)\n            sibling = that.closest(sibling);\n        else\n            sibling = that.parent().next();\n        var menu = sibling.find('[data-toggle=\"dropdown\"]');\n        if (loader) loader.show();\n        section.fadeTo('fast', 0.5);\n        $.ajax(href)\n        .always(function(){\n            if (loader) loader.hide();\n            section.stop();\n            section.fadeTo('fast', 1.0);\n        })\n        .done(function(data) {\n            showPermanentSuccess(sibling, data.status_msg);\n        })\n        .fail(function(jqXHR) {\n            var status_msg = getStatusMsg(jqXHR);\n            if (jqXHR.status == 404) {\n                showSuccess(sibling, status_msg);\n            }\n            else {\n                showPermanentError(sibling, status_msg);\n            }\n        });\n        if (menu.length)\n            menu.dropdown('toggle'); // close dropdown menu\n\n        return false;\n    });\n\n    $('#section').on('click', '.call-modal-confirm-link', function(event) {\n        var that = $(this);\n        if (that.hasClass('disabled'))\n            return false;\n        var url = that.attr('href');\n        var modal_id = that.attr('data-target');\n        var content  = that.attr('data-content');\n        var modal = $(modal_id);\n        modal.find('#content').html(content);\n        var confirm_link = modal.find('a.btn-primary').first();\n        modal.modal({ show: true });\n        confirm_link.off('click');\n        confirm_link.attr('href',url);\n        confirm_link.click(function() {\n            modal.modal('hide');\n        });\n        return false;\n    });\n\n    $('#section').on('click', '.call-modal-confirm-form', function(event) {\n        var that = $(this);\n        if (that.hasClass('disabled'))\n            return false;\n        var form;\n        var modal_id = that.attr('data-modal');\n        var form_id = that.attr('data-modal-form');\n        var modal    = $('#' + modal_id);\n        var content  = that.attr('data-content');\n        var confirm_link = modal.find('a.btn-primary').first();\n        if (form_id) {\n            form = $('#' + form_id);\n        } else {\n            form = that.closest('form');\n        }\n        if (content) {\n            modal.find('#content').html(content);\n        }\n        var valid = isFormValid(form);\n        if (valid) {\n            modal.modal({ show: true });\n            confirm_link.off('click');\n            confirm_link.click(function() {\n                $.ajax({\n                    'url'  : form.attr('action'),\n                    'type' : form.attr('method') || \"POST\",\n                    'data' : form.serialize()\n                })\n                    .always(function() {\n                        modal.modal('hide');\n                    })\n                    .done(function(data) {\n                        if (data.status_msg) {\n                            $(\"body,html\").animate({scrollTop:0}, 'fast');\n                            showSuccess($('h2').first().next(), data.status_msg);\n                        } else {\n                            $(window).hashchange();\n                        }\n                    })\n                    .fail(function(jqXHR) {\n                        $(\"body,html\").animate({scrollTop:0}, 'fast');\n                        var status_msg = getStatusMsg(jqXHR);\n                        showError($('#section h2'), status_msg);\n                    });\n                return false;\n            });\n        }\n        return false;\n    });\n\n    $('#section').on('click', '.call-modal', function(event) {\n        var that = $(this);\n        if (that.hasClass('disabled'))\n            return false;\n        var url = that.attr('href');\n        var modal_id = that.attr('data-modal');\n        var content  = that.attr('data-modal-content');\n        var modal = $('#' + modal_id);\n        if(content) {\n            modal.find('#content').html(content);\n        }\n        var confirm_link = modal.find('a.btn-primary').first();\n        modal.modal({ show: true });\n        confirm_link.off('click');\n        confirm_link.click(function() {\n            $.ajax(url)\n                .always(function() {\n                    modal.modal('hide');\n                })\n                .done(function(data) {\n                    $(window).hashchange();\n                })\n                .fail(function(jqXHR) {\n                    $(\"body,html\").animate({scrollTop:0}, 'fast');\n                    var status_msg = getStatusMsg(jqXHR);\n                    showError($('#section h2'), status_msg);\n                });\n            return false;\n        });\n\n        return false;\n    });\n\n    $('#section').on('click',\n        '[data-toggle=\"modal\"][data-target][data-href-background]',\n        function(event) {\n            var that  = $(this);\n            var href  = that.attr(\"data-href-background\");\n            var modal = $(that.attr(\"data-target\"));\n            var button = modal.find(\".btn-primary\").first();\n            button.off('click');\n            button.click(function() {\n                $.ajax(href)\n                    .done(function(data) {\n                        $(window).hashchange();\n                    })\n                    .fail(function(jqXHR) {\n                        $(\"body,html\").animate({scrollTop:0}, 'fast');\n                        var status_msg = getStatusMsg(jqXHR);\n                        showError($('#section h2'), status_msg);\n                    });\n            });\n    });\n\n    /* Add an extended duration to a text input field */\n    $('#section').on('click', '#addExtendedTime', function(event) {\n        var btn = $(this);\n        var group = btn.closest('.extended-duration');\n        var duration = group.data('duration'); // set in updateExtendedDurationExample\n        if (duration) {\n            var input = $(btn.data('target'));\n            var str = input.val();\n            var found = false;\n            $.each(str.split(/ *, */), function(index, value) {\n                if (value == duration) {\n                    found = true;\n                    return false;\n                }\n            });\n            if (!found)\n                input.val(str? str + \",\" + duration : duration);\n        }\n\n        return false;\n    });\n\n    /* Update any extended duration examples when loading section */\n    $('body').on('section.loaded', function(event) {\n        updateExtendedDurationExample($('.extended-duration'));\n        bindExportCSV();\n        FingerbankSearch.setup();\n        setupObfuscatedTextHover('.pf-obfuscated-text + button');\n\n        // If the section includes a dynamic sidenav section, move it to the sidenav row\n        var sidenav = $('.sidenav-fluid .row-fluid').first();\n        $('#section').find('.sidenav-section').each(function() {\n            if (this.id && sidenav.find('#' + this.id).length > 0)\n                // Section is already there; show it\n                sidenav.find('#' + this.id).removeClass('hide');\n            else {\n                // Append section\n                $(this).detach().appendTo(sidenav).removeClass('hide');\n            }\n        });\n\n        $('[data-pf-toggle=\"password\"]').on('mouseenter focus', function(event) {\n            event.currentTarget.removeAttribute('readonly');\n        });\n    });\n\n    /* Update extended duration widget when changing parameters of the duration */\n    $('#section').on('change', '.extended-duration', function(event) {\n        var input = $(event.target);\n        var group = input.closest('.extended-duration');\n\n        if (input.is('[name$=\"day_base\"]')) {\n            // Advanced options are available only if \"relative to the beginning of the day\" is checked\n            var enabled = input.is(':checked');\n            if (enabled)\n                group.find('[name*=extended_duration], [name$=period_base]').removeAttr('disabled').removeClass('disabled');\n            else {\n                group.find('input[name*=extended_duration], select[name*=extended_duration], input[name$=period_base]').attr('disabled', 'disabled');\n                group.find('a[name*=extended_duration]').addClass('disabled');\n            }\n        }\n\n        updateExtendedDurationExample(group);\n    });\n\n    if (typeof init == 'function') init();\n    if (typeof initModals == 'function') initModals();\n\n    $('#checkup_task_toggle').click(function (e) {\n        e.preventDefault();\n        $( \".checkup_results\" ).remove();\n        $('<li class=\"checkup_results disabled\"><div class=\"text-center\"><i class=\"icon-spin icon-circle-o-notch\"></i></div></li>').insertAfter($(this).parent());\n        $.get(\"/admin/checkup\", function(data){\n            var results = $(\".checkup_results\");\n            var li;\n            results.html('<a href=\"#\" disabled>Result(s):</a>');\n            if(data.items.problems.length > 0){\n                for(var i in data.items.problems){\n                    li = $('<li class=\"checkup_results disabled\"><a href=\"#\" disabled>'+data.items.problems[i].severity+' : '+data.items.problems[i].message+'</a></li>');\n                    li.insertAfter(results);\n                }\n            } else {\n                li = $('<li class=\"checkup_results disabled\"><a href=\"#\" disabled>No problem detected!</a></li>');\n                li.insertAfter(results);\n            }\n        });\n        return false;\n    });\n\n    $('#fixpermissions_task_toggle').click(function (e) {\n        e.preventDefault();\n        $( \".fixpermissions_results\" ).remove();\n        $('<li class=\"fixpermissions_results disabled\"><div class=\"text-center\"><i class=\"icon-spin icon-circle-o-notch\"></i></div></li>').insertAfter($(this).parent());\n        $.get(\"/admin/fixpermissions\", function(data){\n            var results = $(\".fixpermissions_results\");\n            var li;\n            results.html('<a href=\"#\" disabled>Result(s):</a>');\n            li = $('<li class=\"fixpermissions_results disabled\"><a href=\"\" disabled>Fixed permissions !</a></li>');\n            li.insertAfter(results);\n        });\n        return false;\n    });\n\n    $('#section').on('show', '.modal', function(e) {\n      FingerbankSearch.setup();\n      setupObfuscatedTextHover('.modal .pf-obfuscated-text + button');\n    });\n\n});\n\nfunction obfuscatedTextHover(element, type, class_remove, class_add) {\n    var input = element.prev();\n    input.attr('type', type);\n    var x_placeholder = input.attr('x-placeholder');\n    if (x_placeholder) {\n        var placeholder = input.attr('placeholder');\n        input.attr('placeholder', x_placeholder);\n        input.attr('x-placeholder', placeholder);\n    }\n    element.find('i').removeClass(class_remove).addClass(class_add);\n}\n\nfunction obfuscatedTextHoverOnEvent(e) {\n    obfuscatedTextHover($(this), 'text', 'icon-eye', 'icon-eye-slash');\n}\n\nfunction obfuscatedTextHoverOffEvent(e) {\n    obfuscatedTextHover($(this), 'password', 'icon-eye-slash', 'icon-eye');\n}\n\nfunction setupObfuscatedTextHover(selector) {\n    var element = $(selector);\n    //remove the previous\n    element.off(\"mouseenter.pf mouseleave.pf\");\n    element.on(\"mouseenter.pf\", obfuscatedTextHoverOnEvent);\n    element.on(\"mouseleave.pf\", obfuscatedTextHoverOffEvent);\n}\n\nfunction FingerbankSearch() {\n\n}\n\nFingerbankSearch.prototype.model_stripped = function() {\n  var that = this;\n  return this.model.split('::Model::')[1].toLowerCase();\n};\n\nFingerbankSearch.prototype.search = function(query, process) {\n  var that = this;\n  var path = this.model_stripped();\n  $.ajax({\n      type: 'POST',\n      url: '/config/fingerbank/'+path+'/typeahead_search',\n      headers: {\n          Accept: 'application/json',\n      },\n      data: {\n          'json': 1,\n          'query': query,\n          'model': this.model,\n      },\n      success: function(data) {\n          var results = $.map(data.items, function(i) {\n              return i.display;\n          });\n          that.results = data.items;\n          var input = that.typeahead_field;\n          var control = input.closest('.control-group');\n          if (results.length === 0)\n              control.addClass('error');\n          else\n              control.removeClass('error');\n          process(results);\n      }\n  });\n};\n\nFingerbankSearch.setup = function() {\n  $('.fingerbank-type-ahead').doOnce('.fingerbank-type-ahead', function(){ \n      var o = this;\n\n      // Creating a new scope since we are in a loop\n      (function() {\n        var search = new FingerbankSearch();\n        search.typeahead_field = $(o);\n        // We prevent the browser autocompletion\n        search.typeahead_field.attr('autocomplete', \"off\");\n        search.typeahead_btn = $($(o).attr('data-btn'));\n        search.model = $(o).attr('data-type-ahead-for');\n        search.add_to = $('#'+$(o).attr('data-add-to'));\n        search.add_action = $(o).attr('data-add-action');\n        $(o).typeahead({\n          source: $.proxy(search.search, search),\n          minLength: 2,\n          items: 11,\n          matcher: function(item) { return true; }\n        });\n        search.typeahead_btn.click(function(e) {\n          e.preventDefault();\n          var id;\n          var display;\n          $.each(search.results, function(){\n            if(this.display == search.typeahead_field.val()){\n              id = this.id;\n              display = this.display;\n            }\n          });\n          if (search.add_action) {\n            if (search.add_action == 'violationsView.add_fingerbank_trigger')\n              violationsView.add_fingerbank_trigger(search, id, display);\n            else\n              console.warn(\"Unhandled add-action \\\"\" + search.add_action + \"\\\"\");\n          }\n          else {\n            if(display !== undefined) {\n                search.add_to.append('<option selected=\"selected\" value=\"'+id+'\">'+display+'</option>');\n                search.add_to.trigger(\"chosen:updated\");\n            }\n          }\n          search.typeahead_field.val('');\n          return false;      \n        });\n      })();\n  });\n};\n"]}